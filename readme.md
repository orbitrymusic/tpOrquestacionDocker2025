üöÄ Auth_Service: Gu√≠a de Arranque y TroubleshootingEste documento describe c√≥mo levantar el entorno de desarrollo y la aplicaci√≥n del microservicio de autenticaci√≥n. Utilizamos Docker Compose para orquestar la base de datos (MongoDB) y el cliente visual (mongo-client), mientras que el backend de Node.js se ejecuta de forma local para facilitar la depuraci√≥n (npm run dev).üõ†Ô∏è 1. Requisitos y Configuraci√≥n PreviaAseg√∫rate de tener instalados Docker Desktop (para los servicios de contenedores), Node.js y las dependencias del proyecto.1.1. Modificaci√≥n Cr√≠tica del Archivo .envPara que tu aplicaci√≥n local (npm run dev) pueda conectarse al contenedor de MongoDB, la variable MONGODB_URI debe apuntar a tu m√°quina anfitriona (localhost), ya que el puerto 27017 est√° expuesto por Docker:Configuraci√≥nValor RequeridoMONGODB_URImongodb://localhost:27017/authdb1.2. Instalaci√≥n de DependenciasEjecuta este comando una sola vez para instalar todas las dependencias del proyecto:Bashnpm install
2. Flujo de ArranqueSigue estos dos pasos para iniciar todo el entorno de desarrollo:Paso 1: Levantar los Servicios de DockerEjecuta este comando en la ra√≠z del proyecto para iniciar la base de datos (mongo-server) y el cliente visual (mongo-client):Bashdocker-compose up -d mongo-server mongo-client
Verificaci√≥n: Aseg√∫rate de que los contenedores est√©n en estado Up:Bashdocker-compose ps
Acceso a la Base de Datos: Puedes acceder al cliente visual Mongo Express en http://localhost:8082.Paso 2: Arrancar el Backend (API de Node.js)Una vez que los contenedores est√©n listos, inicia tu aplicaci√≥n de Node.js en modo desarrollo:Bashnpm run dev
Tu API ahora est√° corriendo en http://localhost:3001 y conectada a MongoDB a trav√©s de localhost:27017.3. Gu√≠a de Troubleshooting (Soluci√≥n de Problemas Comunes)Aqu√≠ se detallan los problemas que enfrentamos y las soluciones permanentes.3.1. Error de Conexi√≥n: ECONNREFUSED / ENOTFOUNDErrorMensaje VistoCausa Ra√≠zSoluci√≥ngetaddrinfo ENOTFOUND mongo-serverLa aplicaci√≥n local no puede resolver el nombre del host mongo-server.Flujo Incorrecto: La API se ejecuta fuera de Docker, pero usa un host interno de Docker.Corregir el .env para usar localhost (ver secci√≥n 1.1).ECONNREFUSED 127.0.0.1:27017La aplicaci√≥n Node.js intenta conectarse, pero no hay un servicio escuchando.El contenedor mongo-server no est√° levantado o no est√° exponiendo el puerto.Asegurarse de que el docker-compose.yml mapee el puerto: ports: - "27017:27017".3.2. Contenedor MongoDB Reiniciando (Restarting)Si el contenedor mongo-server entra en un bucle de reinicio, es probable que haya datos o permisos corruptos en el volumen persistente.Comando de Soluci√≥n:Det√©n y elimina el contenedor y su volumen de datos asociados (perder√°s la informaci√≥n guardada):Bashdocker-compose down -v
Vuelve al Paso 1 del flujo de arranque para iniciar la base de datos de forma limpia.3.3. Error de Conflicto de Nombres o PuertosSi recibes errores como Conflict. The container name "/mongo-server" is already in use o address already in use (8082):Conflicto de Nombres: Elimina el contenedor viejo forzadamente:Bashdocker rm -f <nombre-del-contenedor-en-conflicto>
Conflicto de Puertos: Alg√∫n otro programa o contenedor est√° usando el puerto.Det√©n el proceso conflictivo (usando sudo lsof -i :<puerto>) o,Cambia el puerto mapeado en el docker-compose.yml (ej., cambiar 8082:8082 a 8083:8082).4. Detener y Limpiar el EntornoPara detener √∫nicamente los servicios de Docker:Bashdocker-compose stop
Para detener y eliminar los contenedores y redes (la mejor pr√°ctica al finalizar la jornada):Bashdocker-compose down